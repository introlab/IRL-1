<?xml version="1.0"?>

<!--
	WARNING : Camera angle given by the kinect is relative to the horizon,
			  not the base!
			  There is no way to retrieve the base orientation, that's why
			  this model will work only if the base is parallel with the
			  ground.

	More informations on
	http://openkinect.org/wiki/Protocol_Documentation#Motor_Initialization

	If you don't use the ball joint, you should use the kinect_camera model,
	otherwise you will have to publish the camera joint state.

	Author : Cyril Lugan
-->

<robot xmlns:sensor="http://playerstage.sourceforge.net/gazebo/xmlschema/#sensor"
	xmlns:controller="http://playerstage.sourceforge.net/gazebo/xmlschema/#controller"
	xmlns:interface="http://playerstage.sourceforge.net/gazebo/xmlschema/#interface"
	xmlns:xacro="http://ros.org/wiki/xacro">

	<include filename="$(find irl_common_description)/urdf/sensors/kinect_camera.urdf.xacro" />

	<xacro:macro name="kinect" params="name parent xyz rpy material">

		<joint name="${name}_base_joint" type="fixed">
			<origin xyz="${xyz}" rpy="${rpy}" />
			<parent link="${parent}"/>
			<child link="${name}_base_link"/>
		</joint>

		<link name="${name}_base_link">
			<visual>
				<geometry>
					<box size="0.06 0.08 0.02" />
				</geometry>
				<material name="${material}" />
			</visual>
		</link>

		<joint name="${name}_camera_joint" type="revolute">
			<axis xyz="0 -1 0"/>
			<!--
				According to open kinect
				+31 degrees (up) and -31 degrees (down)
			-->
			<limit lower="${-0.541}" upper="${0.541}" effort="15" velocity="5" /> <!-- random effort/velocity -->
			<origin xyz="0 0 0.02" rpy="0 0 0" />
			<parent link="${name}_base_link"/>
			<child link="${name}_camera_link"/>
		</joint>

		<xacro:kinect_camera
			name="${name}"
			xyz="0 0 0"
			rpy="0 0 0"
			material="${material}"
			/>

	</xacro:macro>

</robot>
